import{S as te,i as ne,N as pe,P as ge,w as V,x as N,y as R,q as D,o as L,B,F as be,e as C,k as I,c as y,a as S,d as _,m as T,b,O,g as w,Q as j,J as ve,K as we,L as ke,s as le,R as Ee,T as Y,U as oe,V as ue,W as Ce,v as ye,X as Me,E as re,Y as Se,Z as Ie,_ as Te,$ as Ue,I as Z,a0 as De,a1 as x,t as Le,h as Oe}from"../chunks/vendor-d4ddf886.js";function Ve(s){let e,n,t,r,d,m;const p=s[3].default,i=be(p,s,s[4],null);return{c(){e=C("div"),n=I(),t=C("div"),i&&i.c(),this.h()},l(l){e=y(l,"DIV",{class:!0}),S(e).forEach(_),n=T(l),t=y(l,"DIV",{class:!0});var a=S(t);i&&i.l(a),a.forEach(_),this.h()},h(){b(e,"class","background svelte-1jyu0ly"),O(e,"open",s[0]),b(t,"class","modal svelte-1jyu0ly"),O(t,"open",s[0])},m(l,a){w(l,e,a),w(l,n,a),w(l,t,a),i&&i.m(t,null),r=!0,d||(m=j(e,"click",s[1]),d=!0)},p(l,a){a&1&&O(e,"open",l[0]),i&&i.p&&(!r||a&16)&&ve(i,p,l,l[4],r?ke(p,l[4],a,null):we(l[4]),null),a&1&&O(t,"open",l[0])},i(l){r||(D(i,l),r=!0)},o(l){L(i,l),r=!1},d(l){l&&_(e),l&&_(n),l&&_(t),i&&i.d(l),d=!1,m()}}}function Ne(s){let e,n;return e=new ge({props:{$$slots:{default:[Ve]},$$scope:{ctx:s}}}),{c(){V(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,r){R(e,t,r),n=!0},p(t,[r]){const d={};r&17&&(d.$$scope={dirty:r,ctx:t}),e.$set(d)},i(t){n||(D(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Re(s,e,n){let{$$slots:t={},$$scope:r}=e,{open:d=!1}=e,{onClose:m=()=>{}}=e;function p(){n(0,d=!1),m()}return s.$$set=i=>{"open"in i&&n(0,d=i.open),"onClose"in i&&n(2,m=i.onClose),"$$scope"in i&&n(4,r=i.$$scope)},[d,p,m,t,r]}class Be extends te{constructor(e){super();ne(this,e,Re,Ne,pe,{open:0,onClose:2})}}const{window:se}=Me;function je(s){let e,n,t,r,d,m,p,i,l,a,f,h,k,M,u,g,E,A,F;return m=new Se({}),l=new Ie({}),k=new Te({}),g=new Ue({}),{c(){e=C("canvas"),n=I(),t=C("video"),r=I(),d=C("button"),V(m.$$.fragment),p=I(),i=C("button"),V(l.$$.fragment),a=I(),f=C("button"),h=C("span"),V(k.$$.fragment),M=I(),u=C("span"),V(g.$$.fragment),this.h()},l(o){e=y(o,"CANVAS",{width:!0,height:!0,class:!0}),S(e).forEach(_),n=T(o),t=y(o,"VIDEO",{width:!0,height:!0,class:!0}),S(t).forEach(_),r=T(o),d=y(o,"BUTTON",{class:!0});var v=S(d);N(m.$$.fragment,v),v.forEach(_),p=T(o),i=y(o,"BUTTON",{class:!0});var G=S(i);N(l.$$.fragment,G),G.forEach(_),a=T(o),f=y(o,"BUTTON",{class:!0});var U=S(f);h=y(U,"SPAN",{class:!0});var J=S(h);N(k.$$.fragment,J),J.forEach(_),M=T(U),u=y(U,"SPAN",{class:!0});var H=S(u);N(g.$$.fragment,H),H.forEach(_),U.forEach(_),this.h()},h(){b(e,"width",s[1]),b(e,"height",s[2]),b(e,"class","svelte-1elb3u5"),t.autoplay=!0,b(t,"width",s[1]),b(t,"height",s[2]),b(t,"class","svelte-1elb3u5"),b(d,"class","btn close svelte-1elb3u5"),b(i,"class","btn switch svelte-1elb3u5"),b(h,"class","checked svelte-1elb3u5"),b(u,"class","unchecked svelte-1elb3u5"),b(f,"class","btn capture svelte-1elb3u5"),O(f,"active",s[7]),O(f,"recording",s[8])},m(o,v){w(o,e,v),s[19](e),w(o,n,v),w(o,t,v),s[20](t),w(o,r,v),w(o,d,v),R(m,d,null),w(o,p,v),w(o,i,v),R(l,i,null),w(o,a,v),w(o,f,v),Z(f,h),R(k,h,null),Z(f,M),Z(f,u),R(g,u,null),E=!0,A||(F=[j(d,"click",s[9]),j(i,"click",s[10]),j(f,"mousedown",s[11]),j(f,"touchstart",s[11])],A=!0)},p(o,v){(!E||v[0]&2)&&b(e,"width",o[1]),(!E||v[0]&4)&&b(e,"height",o[2]),(!E||v[0]&2)&&b(t,"width",o[1]),(!E||v[0]&4)&&b(t,"height",o[2]),v[0]&128&&O(f,"active",o[7]),v[0]&256&&O(f,"recording",o[8])},i(o){E||(D(m.$$.fragment,o),D(l.$$.fragment,o),D(k.$$.fragment,o),D(g.$$.fragment,o),E=!0)},o(o){L(m.$$.fragment,o),L(l.$$.fragment,o),L(k.$$.fragment,o),L(g.$$.fragment,o),E=!1},d(o){o&&_(e),s[19](null),o&&_(n),o&&_(t),s[20](null),o&&_(r),o&&_(d),B(m),o&&_(p),o&&_(i),B(l),o&&_(a),o&&_(f),B(k),B(g),A=!1,De(F)}}}function qe(s){let e,n,t,r,d;Ee(s[18]);function m(i){s[21](i)}let p={$$slots:{default:[je]},$$scope:{ctx:s}};return s[0]!==void 0&&(p.open=s[0]),e=new Be({props:p}),Y.push(()=>oe(e,"open",m)),{c(){V(e.$$.fragment)},l(i){N(e.$$.fragment,i)},m(i,l){R(e,i,l),t=!0,r||(d=j(se,"resize",s[18]),r=!0)},p(i,l){const a={};l[0]&414|l[1]&4&&(a.$$scope={dirty:l,ctx:i}),!n&&l[0]&1&&(n=!0,a.open=i[0],ue(()=>n=!1)),e.$set(a)},i(i){t||(D(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){B(e,i),r=!1,d()}}}function Pe(s,e){return s.getContext("2d").drawImage(e,0,0,s.width,s.height),new Promise(t=>{s.toBlob(t)})}function We(s){const e=new MediaRecorder(s),n=[];return e.addEventListener("dataavailable",function(t){t.data.size>0&&n.push(t.data)}),e.start(),()=>new Promise(t=>{e.addEventListener("stop",()=>{t(new Blob(n))}),e.stop()})}function Ae(s,e,n){let t,{open:r=!1}=e,{audio:d=!1}=e,{video:m=!1}=e,{width:p=0}=e,{height:i=0}=e,{mediaStream:l=void 0}=e,{player:a=void 0}=e,{canvas:f=void 0}=e;const h=Ce();let k=!1,M=!1,u,g;function E(){n(0,r=!1)}function A(){W=W>=X.length-1?0:W+1,H()}function F(c){c.type==="mousedown"&&c.button!==0||k||(n(7,k=!0),m&&(u=setTimeout(()=>{k&&(n(8,M=!0),g=We(l)),u=void 0},500)))}function o(){k&&(n(7,k=!1),u&&(clearTimeout(u),u=void 0),M?(n(8,M=!1),G()):v())}function v(){re().then(()=>Pe(f,a)).then(c=>h("image",c))}function G(){re().then(g).then(c=>h("video",c))}ye(()=>(window.document.addEventListener("mouseup",o),window.document.addEventListener("mouseleave",o),()=>{window.document.removeEventListener("mouseup",o),window.document.removeEventListener("mouseleave",o),U()}));function U(){l&&(l.getTracks().forEach(c=>c.stop()),n(12,l=void 0),n(3,a.srcObject=void 0,a))}function J(){navigator.mediaDevices.enumerateDevices().then(c=>{X=c.filter(z=>z.kind==="videoinput"),W>=X.length&&(W=0),H()})}function H(){var c;U(),navigator.mediaDevices.getUserMedia({video:{deviceId:(c=X[W])==null?void 0:c.deviceId},audio:d}).then(z=>{let $=0,ee=0;z.getVideoTracks().forEach(he=>{const ie=he.getSettings();$=Math.max($,ie.width),ee=Math.max(ee,ie.height)}),n(15,q=$),n(16,P=ee),n(1,p=q*t),n(2,i=P*t),n(12,l=z),n(3,a.srcObject=z,a)})}let K,Q,q=1,P=1,X=[],W=0;function ce(){n(5,K=se.innerWidth),n(6,Q=se.innerHeight)}function de(c){Y[c?"unshift":"push"](()=>{f=c,n(4,f)})}function me(c){Y[c?"unshift":"push"](()=>{a=c,n(3,a)})}function _e(c){r=c,n(0,r)}return s.$$set=c=>{"open"in c&&n(0,r=c.open),"audio"in c&&n(13,d=c.audio),"video"in c&&n(14,m=c.video),"width"in c&&n(1,p=c.width),"height"in c&&n(2,i=c.height),"mediaStream"in c&&n(12,l=c.mediaStream),"player"in c&&n(3,a=c.player),"canvas"in c&&n(4,f=c.canvas)},s.$$.update=()=>{s.$$.dirty[0]&4097&&r&&!l&&typeof navigator.mediaDevices!="undefined"&&J(),s.$$.dirty[0]&4097&&!r&&l&&U(),s.$$.dirty[0]&98400&&n(17,t=q>K||P>Q?Math.min(K/q,Q/P):1),s.$$.dirty[0]&163840&&n(1,p=q*t),s.$$.dirty[0]&196608&&n(2,i=P*t)},[r,p,i,a,f,K,Q,k,M,E,A,F,l,d,m,q,P,t,ce,de,me,_e]}class He extends te{constructor(e){super();ne(this,e,Ae,qe,le,{open:0,audio:13,video:14,width:1,height:2,mediaStream:12,player:3,canvas:4},null,[-1,-1])}}function ae(s){let e,n;return{c(){e=C("img"),this.h()},l(t){e=y(t,"IMG",{src:!0,class:!0}),this.h()},h(){x(e.src,n=s[1])||b(e,"src",n),b(e,"class","svelte-rqyyga")},m(t,r){w(t,e,r)},p(t,r){r&2&&!x(e.src,n=t[1])&&b(e,"src",n)},d(t){t&&_(e)}}}function fe(s){let e,n;return{c(){e=C("video"),this.h()},l(t){e=y(t,"VIDEO",{src:!0,class:!0}),S(e).forEach(_),this.h()},h(){x(e.src,n=s[2])||b(e,"src",n),e.controls=!0,b(e,"class","svelte-rqyyga")},m(t,r){w(t,e,r)},p(t,r){r&4&&!x(e.src,n=t[2])&&b(e,"src",n)},d(t){t&&_(e)}}}function ze(s){let e,n,t,r,d,m,p,i,l,a,f=s[1]&&ae(s),h=s[2]&&fe(s);function k(u){s[6](u)}let M={video:!0};return s[0]!==void 0&&(M.open=s[0]),m=new He({props:M}),Y.push(()=>oe(m,"open",k)),m.$on("image",s[4]),m.$on("video",s[5]),{c(){e=C("button"),n=Le("Capture"),t=I(),f&&f.c(),r=I(),h&&h.c(),d=I(),V(m.$$.fragment)},l(u){e=y(u,"BUTTON",{});var g=S(e);n=Oe(g,"Capture"),g.forEach(_),t=T(u),f&&f.l(u),r=T(u),h&&h.l(u),d=T(u),N(m.$$.fragment,u)},m(u,g){w(u,e,g),Z(e,n),w(u,t,g),f&&f.m(u,g),w(u,r,g),h&&h.m(u,g),w(u,d,g),R(m,u,g),i=!0,l||(a=j(e,"click",s[3]),l=!0)},p(u,[g]){u[1]?f?f.p(u,g):(f=ae(u),f.c(),f.m(r.parentNode,r)):f&&(f.d(1),f=null),u[2]?h?h.p(u,g):(h=fe(u),h.c(),h.m(d.parentNode,d)):h&&(h.d(1),h=null);const E={};!p&&g&1&&(p=!0,E.open=u[0],ue(()=>p=!1)),m.$set(E)},i(u){i||(D(m.$$.fragment,u),i=!0)},o(u){L(m.$$.fragment,u),i=!1},d(u){u&&_(e),u&&_(t),f&&f.d(u),u&&_(r),h&&h.d(u),u&&_(d),B(m,u),l=!1,a()}}}function Fe(s,e,n){let t=!1;function r(){console.log(),n(0,t=!0)}let d;function m(a){n(1,d=URL.createObjectURL(a.detail)),n(0,t=!1)}let p;function i(a){n(2,p=URL.createObjectURL(a.detail)),n(0,t=!1)}function l(a){t=a,n(0,t)}return[t,d,p,r,m,i,l]}class Je extends te{constructor(e){super();ne(this,e,Fe,ze,le,{})}}export{Je as default};
